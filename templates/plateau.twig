<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Dario Battle</title>
        
        <script type="text/javascript">
        
        //liens utiles
        //https://www.w3schools.com/graphics/game_controllers.asp
        //https://www.w3schools.com/graphics/tryit.asp?filename=trygame_controllers_keys
        //http://users.polytech.unice.fr/~strombon/camash/Foundation%20HTML5%20Animation%20with%20JavaScript/html5-animation-source-code/
        //http://stackoverflow.com/questions/14389864/javascript-html5-making-a-canvas-animation-using-wasd-to-move-around-a-rectang
        
        var mario = new Image();
        mario.src= "/img/mario-static-right.png";
        //test de solution pour entrer clavier
        (function(){
          // prend le frame rate optimal pour chaque navigateur
            var requestAnimationFrame = window.mozRequestAnimationFrame    ||
                window.webkitRequestAnimationFrame ||
                window.msRequestAnimationFrame     ||
                window.oRequestAnimationFrame;
                window.requestAnimationFrame = requestAnimationFrame;
        })();
        //evenement pour savoir quelles touches sont utilisées
        window.addEventListener("keydown",onKeyDown,false);
        window.addEventListener("keyup",onKeyUp,false);
        
        //fonction qui indique quelle touche est enfoncée
        function onKeyDown(event) {
              var keyCode = event.keyCode;
              switch (keyCode) {
                case 68: //d
                keyD = true;
                break;
                case 83: //s
                  keyS = true;
                  break;
                case 81: //q
                  keyQ = true;
                  break;
                case 90: //z
                  keyZ = true;
                  break;
                }
        }

        //fonction pour savoir quelle touche n'est pas enfoncée
        function onKeyUp(event) {
          var keyCode = event.keyCode;
        
          switch (keyCode) {
            case 68: //d
              keyD = false;
              break;
            case 83: //s
              keyS = false;
              break;
            case 81: //q
              keyQ = false;
              break;
            case 90: //z
              keyZ = false;
              break;
          }
        }
        
        var keyQ = false;
        var keyZ = false;
        var keyS = false;
        var keyD = false;
        
        var x =  0;// position de base de mario en x
        var y = 480;// position de base de mario en y
        var speed = 5;
        
        function animation(){
            window.requestAnimationFrame(animation);
            var canvas = document.getElementById("darioScene");
            var ctx=canvas.getContext("2d");
            var mario = new Image();
            mario.src= "/img/mario-static-right.png";
            ctx.clearRect(0, 0, canvas.width, canvas.height);//on clear l'ecran a chaque fois
            ctx.drawImage(mario,x,y);// on dessine mario
            if (keyD == true) {
                x += speed;//on fait se déplacer mario vers la droite si la touche Q est enfoncée
            }
            //de même mais vers la gauche
            if (keyQ == true) {
                console.log("q appuyé");
                x-=speed;
            }
            }
            window.requestAnimationFrame(animation);
            
    </script>
    
    <style type="text/css">
      canvas { border: 1px solid black; }
    </style>
    
  </head>
  <!-- Une fois le body chargé on exécute la fonction draw -->
  <body>
   <canvas id="darioScene" width="800" height="600">
  </body>
</html>